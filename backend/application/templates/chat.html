<!DOCTYPE html>
<html lang="pt-BR">
<head>
  {% load static %}
  <meta charset="UTF-8" />
  <meta name="csrf-token" content="{{ csrf_token }}">
  <title>SAMSAI - Chat</title>
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="{% static 'js/script.js' %}"></script>
  <script>
    const conversa_id = "{{ conversa_id }}";
    const mensagens = JSON.parse({{ todas_as_conversas|safe }});
    const todas_as_conversas = JSON.parse({{ todas_as_conversas|safe }});
  </script>
</head>
<body>
  <div id="chatContainer" class="chat-container">
    <div class="sidebar" id="sidebar">
      <h2>HistÃ³rico de Conversas</h2>
      <ul id="historyList">
         <!-- Lista de conversas gerada dinamicamente -->
      </ul>
    </div>
    
    <div class="chat-section" id="chatSection">
      <div class="chat-header">
        <h1>SamsAI</h1>
        <div class="profile-container">
          <span id="profileIcon" class="profile-icon">ðŸ‘¤</span>
          <div id="profileDropdown" class="profile-dropdown"> 
            <a id="logoutBtn" href="{% url 'logout' %}" class="profile-btn">Sair</a>
            <button id="configBtn" class="profile-btn">ConfiguraÃ§Ãµes</button>
          </div>
        </div>
      </div>
      <div class="chat-window" id="chatWindow">
        <p>OlÃ¡, {{ usuario }}. Digite sua mensagem para iniciar uma nova conversa.</p>
        
          <!-- Mensagens serÃ£o renderizadas aqui -->
        
      </div>
        {% if conversa_id is None %}
            <form method="post" action="{% url 'new_chat' %}" class="chat-input">
              {% csrf_token %}
              <button id="fileBtn" class="btn-file">ðŸ“Ž</button>
              <input type="file" id="fileInput" style="display:none;">
              <input name="mensagem_usuario" type="text" id="messageInput" placeholder="Digite sua mensagem...">
              <button id="audioBtn" class="btn-audio">ðŸŽ¤</button>
              <button id="sendBtn" class="btn-send">Enviar</button>
            </form>
        {% else %}
            <form method="post" action="{% url 'chat' conversa_id %}" class="chat-input">
              {% csrf_token %}
              <button id="fileBtn" class="btn-file">ðŸ“Ž</button>
              <input type="file" id="fileInput" style="display:none;">
              <input name="mensagem_usuario" type="text" id="messageInput" placeholder="Digite sua mensagem...">
              <button id="audioBtn" class="btn-audio">ðŸŽ¤</button>
              <button id="sendBtn" class="btn-send">Enviar</button>
            </form>
        {% endif %}
    </div>
  </div>
  
  <!-- Modal customizado para opÃ§Ãµes de conversa (renomear/apagar) -->
  <div id="customModal" class="modal">
    <div class="modal-content">
      <h2 id="modalTitle">OpÃ§Ãµes da Conversa</h2>
      <div id="modalBody">
        <!-- ConteÃºdo dinÃ¢mico (serÃ¡ inserido via JavaScript) -->
      </div>
      <div class="modal-actions">
        <button id="modalCancelBtn">Cancelar</button>
        <button id="modalConfirmBtn">Confirmar</button>
      </div>
    </div>
  </div>

  <!-- Popup de ConfirmaÃ§Ã£o para Apagar Conversa (centralizado) -->
  <div id="deleteModal" class="modal">
    <div class="modal-content">
      <h2 id="deleteModalTitle">Apagar Conversa</h2>
      <p id="deleteModalBody"></p>
      <div class="modal-actions">
        <button id="deleteCancelBtn">Cancelar</button>
        <button id="deleteConfirmBtn">Apagar</button>
      </div>
    </div>
  </div>

  
  <!-- Modal de ConfiguraÃ§Ãµes -->
  <div id="configModal" class="modal">
    <div class="modal-content">
      <span id="closeModal" class="close-button">&times;</span>
      <h2>ConfiguraÃ§Ãµes</h2>
      <form id="configForm">
        <div class="config-section">
          <label>Escolha o tema:</label>
          <div>
            <input type="radio" id="darkTheme" name="theme" value="dark" checked>
            <label for="darkTheme">Escuro</label>
          </div>
          <div>
            <input type="radio" id="lightTheme" name="theme" value="light">
            <label for="lightTheme">Claro</label>
          </div>
        </div>
        <div class="config-section">
          <label for="fontSizeSelect">Tamanho da fonte:</label>
          <select id="fontSizeSelect">
            <option value="14px">Pequeno</option>
            <option value="16px" selected>MÃ©dio</option>
            <option value="18px">Grande</option>
            <option value="20px">Extra Grande</option>
          </select>
        </div>
        <div class="config-section">
          <label for="fontFamilySelect">Fonte:</label>
          <select id="fontFamilySelect">
            <option value="Arial" selected>Arial</option>
            <option value="Verdana">Verdana</option>
            <option value="Times New Roman">Times New Roman</option>
            <option value="Courier New">Courier New</option>
          </select>
        </div>
        <button type="submit" class="config-save-btn">Salvar</button>
      </form>
    </div>
  </div>
  
</body>
</html>

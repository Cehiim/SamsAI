<!DOCTYPE html>
<html lang="pt-BR">
<head>
  {% load static %}
  <meta charset="UTF-8" />
  <meta name="csrf-token" content="{{ csrf_token }}">

  {% if conversa_id is None %}
    <title>SAMSAI - Chat</title>
  {% else %}
    <title>SAMSAI - {{ conversa_atual.nome }}</title>
  {% endif %}
  
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="{% static 'js/script.js' %}"></script>

  <!--O VSCode pode reclamar de erro nas linhas abaixo, mas não há nada errado ;)-->
  <script>
    const conversa_id = "{{ conversa_id }}";
    const todas_as_conversas = JSON.parse({{ todas_as_conversas|safe }});
  </script>
  {% if conversa_id is not None %}
    <script>
      let mensagens = JSON.parse({{ mensagens|safe }});
    </script>
  {% endif %}

</head>
<body>
  <div id="chatContainer" class="chat-container">
    <div class="sidebar" id="sidebar">
      <h2>Conversas</h2>
      <ul id="historyList">
         <!-- Lista de conversas gerada dinamicamente -->
      </ul>
    </div>
    
    <div class="chat-section" id="chatSection">
      <div class="chat-header">
        <h1>SamsAI</h1>
        <div id="profileIcon" class="profile-container">
          <span class="profile-icon"><img style="width: 40px; height: 40px;" src="{% static 'img/user.svg' %}" alt="Configurações"></span>
          <div id="profileDropdown" class="profile-dropdown"> 
            <a id="logoutBtn" href="{% url 'logout' %}" class="profile-btn">Sair</a>
            <button id="configBtn" class="profile-btn">Configurações</button>
          </div>
        </div>
      </div>
      <div class="chat-window" id="chatWindow">
        {% if conversa_id is None %}
        <div class="welcome-message">
          <p>Olá, {{ usuario }}</p>
          <p>Como posso ajudar?</p>
        </div>
        {% else %}
          <!--Mensagens renderizadas pelo Javascript-->
        {% endif %}
      </div>
      <div class="chat-input">
        <button id="fileBtn" class="btn-file"><img style="width: 25px; height: 30px;" src="{% static 'img/paperclip.svg' %}" alt="Envie um PDF"></button>
        <input type="file" id="fileInput" style="display:none;">
        <input name="mensagem_usuario" type="text" id="messageInput" placeholder="Digite sua mensagem...">
        <button id="audioBtn" class="btn-audio"><img style="width: 25px; height: 30px;" src="{% static 'img/microphone.svg' %}" alt="Envie um áudio"></button>
        <button id="sendBtn" class="btn-send">Enviar</button>
      </div>
    </div>
  </div>
  
  <!-- Modal customizado para opções de conversa (renomear/apagar) -->
  <div id="customModal" class="modal">
    <div class="modal-content">
      <h2 id="modalTitle">Opções da Conversa</h2>
      <div id="modalBody">
        <!-- Conteúdo dinâmico (será inserido via JavaScript) -->
      </div>
      <div class="modal-actions">
        <button id="modalCancelBtn">Cancelar</button>
        <button id="modalConfirmBtn">Confirmar</button>
      </div>
    </div>
  </div>

  <!-- Popup de Confirmação para Apagar Conversa (centralizado) -->
  <div id="deleteModal" class="modal">
    <div class="modal-content">
      <h2 id="deleteModalTitle">Apagar Conversa</h2>
      <p id="deleteModalBody"></p>
      <div class="modal-actions">
        <button id="deleteCancelBtn">Cancelar</button>
        <button id="deleteConfirmBtn">Apagar</button>
      </div>
    </div>
  </div>

  
  <!-- Modal de Configurações -->
  <div id="configModal" class="modal">
    <div class="modal-content">
      <span id="closeModal" class="close-button">&times;</span>
      <h2>Configurações</h2>
      <form id="configForm">
        <div class="config-section">
          <label>Escolha o tema:</label>
          <div>
            <input type="radio" id="darkTheme" name="theme" value="dark" checked>
            <label for="darkTheme">Escuro</label>
          </div>
          <div>
            <input type="radio" id="lightTheme" name="theme" value="light">
            <label for="lightTheme">Claro</label>
          </div>
        </div>
        <div class="config-section">
          <label for="fontSizeSelect">Tamanho da fonte:</label>
          <select id="fontSizeSelect">
            <option value="14px">Pequeno</option>
            <option value="16px" selected>Médio</option>
            <option value="18px">Grande</option>
            <option value="20px">Extra Grande</option>
          </select>
        </div>
        <div class="config-section">
          <label for="fontFamilySelect">Fonte:</label>
          <select id="fontFamilySelect">
            <option value="Arial" selected>Arial</option>
            <option value="Verdana">Verdana</option>
            <option value="Times New Roman">Times New Roman</option>
            <option value="Courier New">Courier New</option>
          </select>
        </div>
        <button type="submit" class="config-save-btn">Salvar</button>
      </form>
    </div>
  </div>
  
</body>
</html>